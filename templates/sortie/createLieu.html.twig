{% extends "base.html.twig" %}

{% block title %}Nouvelle Ville{% endblock %}

{% block message %}
<div class="pricing-header px-3 py-3 pb-md-4 mx-auto text-center">
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <h3 class="alert-{{ label }} ">
                {{ message }}
            </h3>
        {% endfor %}
    {% endfor %}
</div>
{% endblock message %}

{% block body %}

    <div class="pricing-header px-3 py-3 pb-md-4 mx-auto text-center">
        <h1>Créer un nouveau lieu</h1>


    </div>


    {{ form_start(formLieu) }}

    <div class="row col-12 pt-2">
    <div class="container align-items-center col-10 col-sm-8 col-md-6 col-lg-6 col-xl-3">
    <div class="form-group">

        {{ form_label(formLieu.nom) }}
        <span style="color:red;">{{ form_errors(formLieu.nom)}}
            {{ form_widget(formLieu.nom, {'attr': {'class': 'form-control'}}) }}
    </div>

    <div class="form-group">
        {{ form_label(formLieu.rue) }}
        <span style="color:red;">{{ form_errors(formLieu.rue)}}
            {{ form_widget(formLieu.rue, {'attr': {'class': 'form-control'}}) }}
    </div>

    <div class="form-group">
        {{ form_label(formLieu.latitude) }}
        <span style="color:red;">{{ form_errors(formLieu.latitude)}}
            {{ form_widget(formLieu.latitude, {'attr': {'class': 'form-control'}}) }}
    </div>

        <div class="form-group">
            {{ form_label(formLieu.longitude) }}
            <span style="color:red;">{{ form_errors(formLieu.longitude) }}
                {{ form_widget(formLieu.longitude, {'attr': {'class': 'form-control'}}) }}
        </div>

{#    <div class="form-group">#}
{#        {{ form_label(formLieu.nbInscriptionsMax) }}#}
{#        <span style="color:red;">{{ form_errors(formLieu.nbInscriptionsMax) }}#}
{#            {{ form_widget(formLieu.nbInscriptionsMax, {'attr': {'class': 'form-control'}}) }}#}
{#    </div>#}

{#    <div class="form-group">#}
{#        {{ form_label(formLieu.infosSortie) }}#}
{#        <span style="color:red;">{{ form_errors(formLieu.infosSortie)}}#}
{#            {{ form_widget(formLieu.infosSortie, {'attr': {'class': 'form-control'}}) }}#}
{#    </div>#}

    <div class="form-group">
        {{ form_label(formLieu.ville) }}
        <span style="color:red;">{{ form_errors(formLieu.ville)}}
            {{ form_widget(formLieu.ville, {'attr': {'class': 'form-control'}}) }}
    </div>
{#        <div class="btn">#}
{#            <a href=""><button>Ajouter ville</button></a>#}
{#        </div>#}
{#    <div class="form-group">#}
{#        {{ form_label(formLieu.lieu) }}#}
{#        <span style="color:red;">{{ form_errors(formLieu.lieu)}}#}
{#            {{ form_widget(formLieu.lieu, {'attr': {'class': 'form-control'}}) }}#}
{#    </div>#}


        <div class="row justify-content-around mb-5" align="center">

    {{ form_widget(formLieu.submit, {'attr': {'class': 'btn btn-primary'}}) }}
{#            {{ form_widget(formLieu.enregistrer, {'attr': {'class': 'btn btn-light'}}) }}#}
        </div>
       </div>
        </div>

    {{ form_end(formLieu) }}

{#    <script>#}
{#        // Executer le script seulement quand la page est chargée#}
{#        $(function() {#}
{#            //le path, est généré au niveau du serveur, on est obligé de lui donner un#}
{#            //identifiant qu'on manipulera après#}
{#            //Pour l'instant c'est 0, mais après on va lui mettre uneVille#}
{#            var url="{{ path('sortie_api_ville', {id:0}) }}";#}

{#            //id champ : sortie_form_ville#}

{#            // jQuery('#sortie_form_ville') $ est un alias#}

{#            // $('#sortie_form_ville').change(function(){#}
{#            //#}
{#            // }); équivalents#}
{#            $('#sortie_form_ville').on('change', afficherLieux);#}
{#            afficherLieux();#}
{#            function afficherLieux(){#}
{#                //On veut récuperer la valeur du champ sélectionné dans le select#}
{#                let uneVille = $('#sortie_form_ville').val();#}

{#                //Vider la liste des lieux (empty vide des éléments html)#}
{#                $('#sortie_form_lieu').empty();#}

{#                //Appel Ajax pour rechargement partiel de la page#}
{#                //Sert à appeler un serveur#}
{#                if(uneVille>0){#}
{#                    //Changement de l'url (attention, ne pas écraser la variable#}
{#                    //sinon, ça ne marchera qu'au chargement de la page)#}
{#                    let urlLieu=url.replace('0',uneVille);#}
{#                    console.log(urlLieu);#}
{#                    $.ajax({url:urlLieu}).done(function(data){#}
{#                        //Traitement des données qu'on a récupéré#}
{#                        for (const lieu of data) {#}
{#                            //Création d'un élément option#}
{#                            let o = $('<option/>',{value:lieu.id, html:lieu.nom});#}
{#                            $('#sortie_form_lieu').append(o);#}
{#                        }#}
{#                    })#}
{#                    .fail(function(){#}
{#                        console.log('erreur');#}
{#                    })#}
{#                }#}
{#            }#}

{#        });#}
{#        //Réussir à faire une API, vérfier qu'elle fonctionne#}
{#        //Ensuite faire le javascript et vérifier chaque étape qu'on manipule les données qu'on pense#}
{#        //étape par étape#}
{#    </script>#}
{% endblock %}